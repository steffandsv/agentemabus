<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MABUS | The Dopamine Engine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- <link rel="stylesheet" href="/css/style.css"> -->
    <link rel="stylesheet" href="/css/liquid.css">

    <!-- GSAP Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
</head>
<body>

<% if (user) { %>
    <%- include('sidebar', { path: path }) %>
<% } %>

<div class="<%= user ? 'main-content' : '' %>">

    <% if (user) { %>
    <!-- Top Header HUD -->
    <header class="top-header">
        <div class="d-flex align-items-center gap-4">
            <!-- Mobile Toggle -->
            <button class="btn btn-outline-secondary d-md-none me-2" onclick="document.querySelector('.sidebar').classList.toggle('open')">
                <i class="fas fa-bars"></i>
            </button>

            <!-- User Info -->
            <div class="text-end me-4">
                <small class="text-muted d-block" style="font-size: 0.7rem;">OPERADOR</small>
                <span class="fw-bold text-main"><%= user.username %></span>
            </div>

            <button id="themeToggle" class="btn btn-sm btn-outline-secondary me-3" onclick="toggleTheme()" title="Alternar Tema">
                <i class="fas fa-sun"></i>
            </button>

            <!-- Watts Capacitor -->
            <div class="watts-capacitor" title="Reserva de Créditos">
                <i class="fas fa-bolt text-gold fa-lg"></i>
                <div class="capacitor-bar-container">
                    <%
                        const percentage = Math.min(100, (user.current_credits / 1000) * 100);
                    %>
                    <div class="capacitor-fill" style="width: <%= percentage %>%"></div>
                </div>
                <span class="watts-value"><%= user.current_credits %> Créditos</span>
            </div>
        </div>
    </header>

<script>
    function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute('data-theme');
        const next = current === 'light' ? 'dark' : 'light';
        body.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);

        const icon = document.querySelector('#themeToggle i');
        if(icon) icon.className = next === 'light' ? 'fas fa-moon' : 'fas fa-sun';
    }

    // Init Theme
    (function() {
        const saved = localStorage.getItem('theme') || 'dark';
        document.body.setAttribute('data-theme', saved);
        document.addEventListener('DOMContentLoaded', () => {
             const icon = document.querySelector('#themeToggle i');
             if(icon) icon.className = saved === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        });
    })();
</script>
    <% } %>

    <div class="container-fluid">
